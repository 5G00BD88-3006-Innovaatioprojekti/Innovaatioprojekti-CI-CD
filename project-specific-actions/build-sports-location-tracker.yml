name: Build Sports Location Tracker
inputs:
  branch:
    required: true
  env:
    required: true

runs:
  using: composite
  steps:
    - name: Checkout repo
      uses: actions/checkout@v3
      with:
        repository: https://github.com/ninopenttinen/Sports-Location-Tracker-Public
        ref: ${{ github.event.inputs.branch }}
        ssh-key: ~/.ssh/sports_location_tracker_deploy.pub
    - name: Build images
      run: |
        cd .dockerfiles
        docker build -t SLT_webapp:latest webapp.Dockerfile
        docker build -t SLT_server:latest --build-arg NODE_ENV=production server.Dockerfile
        docker build -t SLT_db:latest db.Dockerfile
    - name: Build containers
      run: |
        cd ~/Innovaatioprojekti-CI-CD/docker/sports-location-tracker/docker-compose.yml
        TAG="latest" docker-compose build \
          --build-arg GOOGLE_MAP_API_KEY=${{ secrets.SLT_GOOGLE_MAPS_API_KEY }} \
          --build-arg POSTGRES_USER=admin \
          --build-arg POSTGRES_PASSWORD=${{ secrets.SLT_POSTGRES_PASSWORD }}
